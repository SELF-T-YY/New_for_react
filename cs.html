<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="/js/d3.v4.min.js"></script>

<!-- Load the sankey.js function -->
<script src="/sankey.js"></script>

<!-- Create a div where the graph will take place -->
<div id="my_dataviz"></div>

<!-- Add style to links or they won't appear properly-->
<style>
.link {
  fill: none;
  stroke: #000;
  stroke-opacity: .2;
}
.link:hover {
  stroke-opacity: .5;
}
</style>
<script>

    // set the dimensions and margins of the graph
    var margin = {top: 10, right: 10, bottom: 10, left: 10},
        width = 450 - margin.left - margin.right,
        height = 480 - margin.top - margin.bottom;
    console.log("sad");
    // append the svg object to the body of the page
    var svg = d3.select("#my_dataviz").append("svg")
        .attr("width", 1000)
        .attr("height", 1000)
        .append("g")
        .attr("transform",
              "translate(" + 100 + "," + 100+ ")");
    
    // Color scale used
    var color = d3.scaleOrdinal(d3.schemeCategory20);
    
    // Set the sankey diagram properties
    var sankey = d3.sankey()
        .nodeWidth(36)
        .nodePadding(290)
        .size([width, height]);
    
    // load the data
    d3.json("/sankey.json", function(error, graph) {
    
      // Constructs a new Sankey generator with the default settings.
      sankey
          .nodes(graph.nodes)
          .links(graph.links)
          .layout(1);
    
      // add in the links
      var link = svg.append("g")
        .selectAll(".link")
        .data(graph.links)
        .enter()
        .append("path")
          .attr("class", "link")
          .attr("d", sankey.link() )
          .style("stroke-width", function(d) { return Math.max(1, d.dy); })
          .sort(function(a, b) { return b.dy - a.dy; })
          .attr('transform', 'rotate(90) translate(0,-450)')

          // .attr('transform', 'rotate(90) translate(' + (height) + ',' + (width) + ')')

    
      // add in the nodes
      var node = svg.append("g")
        .selectAll(".node")
        .data(graph.nodes)
        .enter().append("g")
          .attr("class", "node")
          .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
          // .attr('transform', 'rotate(90) translate(400,-450)')
          // .call(d3.drag()
          //   .subject(function(d) { return d; })
          //   .on("start", function() { this.parentNode.appendChild(this); })
            // .on("drag", dragmove));
    
      // add the rectangles for the nodes
      node
        .append("rect")
          .attr("height", function(d) { return d.dy; })
          .attr("width", sankey.nodeWidth())
          .style("fill", function(d) { return d.color = color(d.name.replace(/ .*/, "")); })
          .style("stroke", function(d) { return d3.rgb(d.color).darker(2); })
        // Add hover text
        // .append("title")
        //   .text(function(d) { return d.name + "\n" + "There is " + d.value + " stuff in this node"; })
          .attr('transform', 'rotate(90) translate(0,0)');

    
    });
    
    
    </script>